# Default values for gpu-telemetry-pipeline
# This is a YAML-formatted file.

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []

# MQ Server configuration
mqServer:
  enabled: true
  replicaCount: 1
  image:
    repository: gpu-telemetry-pipeline/mq-server
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    tcpPort: 9000
    httpPort: 9001
  
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi
  
  config:
    bufferSize: 50000
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# InfluxDB configuration (external or deploy your own)
influxdb:
  # External InfluxDB URL (if using external instance)
  url: "http://influxdb:8086"
  token: ""  # Required: set via --set or secrets
  org: "cisco"
  bucket: "gpu_telemetry"

# Streamer configuration
streamer:
  enabled: true
  replicaCount: 1
  image:
    repository: gpu-telemetry-pipeline/streamer
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  config:
    batchSize: 100
    collectInterval: "5s"
    loop: true
  
  # CSV data volume
  data:
    # Use existing ConfigMap/Secret for CSV data
    existingConfigMap: ""
    # Or mount a PVC
    existingPVC: ""
    # Or use an inline CSV (for testing)
    csvPath: "/data/telemetry.csv"
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Collector configuration
collector:
  enabled: true
  replicaCount: 1
  image:
    repository: gpu-telemetry-pipeline/collector
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi
  
  config:
    retentionPeriod: "24h"
    flushInterval: "10s"
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# API Gateway configuration
api:
  enabled: true
  replicaCount: 1
  image:
    repository: gpu-telemetry-pipeline/api
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: NodePort
    port: 8080
    nodePort: 30080
  
  ingress:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: gpu-telemetry.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  config:
    enableSwagger: true
    storageType: "influxdb"  # "memory" for dev, "influxdb" for production
    defaultLimit: 100
    maxLimit: 1000
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Autoscaling configuration
autoscaling:
  streamer:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
  
  collector:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
  
  api:
    enabled: false
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80

# Pod disruption budgets
podDisruptionBudget:
  enabled: false
  minAvailable: 1

# Service account
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL
